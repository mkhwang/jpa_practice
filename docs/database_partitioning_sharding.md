# Partitioning & Sharding

### 1. 파티셔닝 (Partitioning)

- **하나의 데이터베이스 테이블을 물리적으로 나누어 저장**하는 기술
- 파티셔닝된 데이터는 여전히 같은 데이터베이스 인스턴스 내에 있지만, 내부적으로 데이터를 나누어 효율적인 조회나 관리를 도움

#### 주요 유형

* **수직 파티셔닝 (Vertical Partitioning)**: 컬럼 단위로 분할. 예: 자주 조회되는 컬럼과 덜 조회되는 컬럼을 나눔
* **수평 파티셔닝 (Horizontal Partitioning)**: 행(row) 단위로 분할. 예: 특정 ID 범위로 나눔
* **범위 파티셔닝, 리스트 파티셔닝, 해시 파티셔닝 등**: SQL 기반에서 다양한 방식으로 행을 나누는 전략

#### 파티션 키 설계 전략

* **균형 있는 분포**: 파티션 간 데이터가 고르게 분포되어야 쿼리 병목이 발생하지 않음
* **쿼리 조건과의 정합성**: WHERE 절에서 자주 사용되는 컬럼을 기준으로 설정하는 것이 성능에 유리
* **변하지 않는 값 사용**: 자주 변경되는 컬럼을 파티션 키로 설정하면 데이터 이동에 따른 성능 저하 가능
* **예측 가능한 파티션 수**: 과도한 파티션은 오히려 관리 복잡도를 높임

#### 장점

* 데이터 액세스 효율화
* 관리 및 백업 용이
* 인덱스 크기 감소로 성능 향상 가능

#### 단점

* 단일 노드에서 처리되므로 확장성 한계
* 파티션 키 설계 실패 시 성능 저하

---

### 2. 샤딩 (Sharding)

- **데이터를 여러 DB 인스턴스(서버)로 물리적으로 나누는 수평적 확장 전략**
- 각 샤드는 독립된 데이터베이스로, 특정 기준(key)에 따라 데이터를 분산 저장

#### 주요 방식

* **해시 샤딩**: 해시 함수로 샤드 결정 (예: user\_id % 4)
* **범위 샤딩**: 특정 값의 범위에 따라 샤드 결정
* **디렉토리 기반 샤딩**: 샤드 위치를 별도의 룩업 테이블로 관리

#### 샤딩 키 설계 전략

* **카디널리티 높은 키 사용**: 충분히 분산이 가능한 키를 사용해야 특정 샤드에 트래픽이 몰리지 않음
* **불변성 고려**: 샤딩 키는 변경 가능성이 낮은 컬럼으로 선택해야 데이터 이동 비용을 줄일 수 있음
* **업무 도메인 연관성 고려**: 연관된 데이터(예: 사용자-게시글)는 같은 샤드에 위치하도록 설계하면 조인 비용 감소
* **샤딩 키 조합 고려**: 단일 키로는 균형이 어려울 경우 복합키(예: region + user\_id)도 고려

#### 장점

* 트래픽 분산, 데이터 저장 분산
* 고가용성 및 병렬 처리 용이
* 물리적인 스케일아웃 가능 (수평 확장)

#### 단점

* 복잡한 쿼리 (조인, 집계 등) 처리 어려움
* 트랜잭션 관리 복잡
* 샤딩 키 설계 실패 시 불균형 발생

---

### 3. 클러스터링 (Clustering)

- **여러 서버가 하나의 데이터베이스처럼 동작하게 구성하는 방식**
- **데이터 자체를 나누는 것이 아니라 인스턴스를 복제하거나 부하 분산**을 위해 사용하는 구조

#### 주요 유형

* **마스터-슬레이브 클러스터링**: 쓰기는 마스터, 읽기는 슬레이브로 분산
* **멀티마스터 클러스터링**: 여러 노드에서 쓰기 가능 (복제 충돌 위험 존재)
* **공유 스토리지 기반 클러스터링**: 다수의 인스턴스가 동일한 스토리지를 참조

#### 장점

* 가용성 증가 (장애 복구 용이)
* 읽기 부하 분산 가능
* 서비스 중단 없이 유지보수 가능

#### 단점

* 쓰기 성능 한계
* 데이터 정합성 관리 필요 (특히 멀티마스터)
* 설정 복잡성

---

### 4. 비교 요약

| 항목      | 파티셔닝        | 샤딩         | 클러스터링         |
| ------- | ----------- | ---------- | ------------- |
| 분할 대상   | 테이블 내부 데이터  | 전체 DB 데이터  | 인스턴스/서버       |
| 목적      | 성능 최적화      | 스케일아웃      | 고가용성, 부하 분산   |
| 저장 위치   | 하나의 DB 인스턴스 | 여러 DB 인스턴스 | 여러 서버 (동일 DB) |
| 쿼리 복잡도  | 낮음          | 높음         | 낮음 (복제 고려)    |
| 확장성     | 제한적         | 우수         | 중간            |
| 트랜잭션 관리 | 쉬움          | 복잡         | 중간            |

---

### 5. 정리

* **파티셔닝**: 단일 DB 내부에서 데이터를 나누는 방법
* **샤딩**: 데이터를 여러 DB로 나눠 저장하는 수평 확장 전략
* **클러스터링**: 여러 인스턴스를 묶어 고가용성과 부하 분산을 제공

